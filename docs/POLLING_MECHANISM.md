# è½®è¯¢æœºåˆ¶è¯´æ˜Ž

## ðŸ”„ æ¸è¿›å¼è½®è¯¢ç­–ç•¥

æœ¬ MCP æœåŠ¡å™¨ä½¿ç”¨**æ™ºèƒ½æ¸è¿›å¼è½®è¯¢**ï¼Œæ ¹æ®ç­‰å¾…æ—¶é—´è‡ªåŠ¨è°ƒæ•´æ£€æŸ¥é¢‘çŽ‡ï¼Œæ—¢ä¿è¯å“åº”é€Ÿåº¦ï¼ŒåˆèŠ‚çœèµ„æºã€‚

## ðŸ“Š è½®è¯¢æ—¶é—´è¡¨

| ç­‰å¾…æ—¶é•¿ | è½®è¯¢é—´éš” | è¯´æ˜Ž |
|---------|---------|------|
| 0 - 30 åˆ†é’Ÿ | **30 ç§’** | å¿«é€Ÿå“åº”æœŸ |
| 30 åˆ†é’Ÿ - 1 å°æ—¶ | **60 ç§’** | ä¸­ç­‰å“åº”æœŸ |
| 1 å°æ—¶ä»¥ä¸Š | **120 ç§’** | èŠ‚èƒ½æ¨¡å¼ |

### ç¤ºä¾‹æ—¶é—´çº¿

```
å¼€å§‹ç­‰å¾…
  â†“
0:00 - æ£€æŸ¥ Telegram
0:30 - æ£€æŸ¥ Telegram  â† 30 ç§’é—´éš”
1:00 - æ£€æŸ¥ Telegram
1:30 - æ£€æŸ¥ Telegram
...
29:30 - æ£€æŸ¥ Telegram
30:00 - æ£€æŸ¥ Telegram
  â†“
30:00 - åˆ‡æ¢åˆ° 60 ç§’é—´éš”
31:00 - æ£€æŸ¥ Telegram  â† 60 ç§’é—´éš”
32:00 - æ£€æŸ¥ Telegram
...
59:00 - æ£€æŸ¥ Telegram
60:00 - æ£€æŸ¥ Telegram
  â†“
60:00 - åˆ‡æ¢åˆ° 120 ç§’é—´éš”
62:00 - æ£€æŸ¥ Telegram  â† 120 ç§’é—´éš”
64:00 - æ£€æŸ¥ Telegram
...
ç»§ç»­ç›´åˆ°æ”¶åˆ°å›žå¤æˆ–è¶…æ—¶ï¼ˆæœ€é•¿ 7 å¤©ï¼‰
```

## â±ï¸ æœ€é•¿ç­‰å¾…æ—¶é—´

**é»˜è®¤**: 604800 ç§’ï¼ˆ7 å¤©ï¼‰

è¿™æ„å‘³ç€ï¼š
- ä½ å¯ä»¥å¯åŠ¨ä¸€ä¸ªä»»åŠ¡
- ç¦»å¼€ç”µè„‘ä¸€å‘¨
- éšæ—¶é€šè¿‡ Telegram å›žå¤
- Codex/Claude Code ä¼šç»§ç»­æ‰§è¡Œ

## ðŸŽ¯ è®¾è®¡ç†å¿µ

### ä¸ºä»€ä¹ˆä½¿ç”¨æ¸è¿›å¼è½®è¯¢ï¼Ÿ

1. **å¿«é€Ÿå“åº”**ï¼ˆå‰ 30 åˆ†é’Ÿï¼‰
   - ç”¨æˆ·é€šå¸¸åœ¨ä»»åŠ¡å¯åŠ¨åŽä¸ä¹…å°±ä¼šå›žå¤
   - 30 ç§’é—´éš”ç¡®ä¿å¿«é€Ÿå“åº”

2. **å¹³è¡¡èµ„æº**ï¼ˆ30 åˆ†é’Ÿ - 1 å°æ—¶ï¼‰
   - ç”¨æˆ·å¯èƒ½åœ¨å¤„ç†å…¶ä»–äº‹æƒ…
   - 60 ç§’é—´éš”è¶³å¤Ÿå¿«ï¼Œåˆä¸æµªè´¹èµ„æº

3. **èŠ‚çœèµ„æº**ï¼ˆ1 å°æ—¶ä»¥ä¸Šï¼‰
   - ç”¨æˆ·å¯èƒ½ç¦»å¼€äº†ç”µè„‘
   - 120 ç§’é—´éš”èŠ‚çœ API è°ƒç”¨å’Œç”µé‡
   - ä»ç„¶èƒ½åœ¨ 2 åˆ†é’Ÿå†…å“åº”

### ä¸ºä»€ä¹ˆæœ€é•¿ç­‰å¾… 7 å¤©ï¼Ÿ

- **çœŸæ­£çš„æ— äººå€¼å®ˆ**: å¯ä»¥å‘¨æœ«å¯åŠ¨ä»»åŠ¡ï¼Œå‘¨ä¸€å›žæ¥ç»§ç»­
- **çµæ´»æ€§**: ä¸ç”¨æ‹…å¿ƒä»»åŠ¡è¶…æ—¶
- **å®žç”¨æ€§**: è¦†ç›–å‡ ä¹Žæ‰€æœ‰å®žé™…ä½¿ç”¨åœºæ™¯

## ðŸ”§ é…ç½®é€‰é¡¹

### è‡ªå®šä¹‰æœ€é•¿ç­‰å¾…æ—¶é—´

åœ¨è°ƒç”¨å·¥å…·æ—¶å¯ä»¥æŒ‡å®šï¼š

```python
telegram_wait_reply(max_wait=3600)  # 1 å°æ—¶
telegram_unattended_mode(max_wait=86400)  # 24 å°æ—¶
```

æˆ–é€šè¿‡çŽ¯å¢ƒå˜é‡ï¼š

```bash
TELEGRAM_MAX_WAIT=86400 codex  # 24 å°æ—¶
```

### è‡ªå®šä¹‰è½®è¯¢é—´éš”

é€šè¿‡çŽ¯å¢ƒå˜é‡ï¼š

```bash
# æ ¼å¼: "é—´éš”1,é—´éš”2,é—´éš”3"ï¼ˆç§’ï¼‰
TELEGRAM_POLL_INTERVAL="10,30,60" codex

# ç¤ºä¾‹ï¼šæ›´æ¿€è¿›çš„è½®è¯¢
# å‰ 10 åˆ†é’Ÿ: 10 ç§’
# 10-30 åˆ†é’Ÿ: 30 ç§’
# 30 åˆ†é’Ÿä»¥ä¸Š: 60 ç§’
```

## ðŸ“ˆ èµ„æºæ¶ˆè€—åˆ†æž

### 7 å¤©ç­‰å¾…çš„ API è°ƒç”¨æ¬¡æ•°

å‡è®¾ç”¨æˆ·åœ¨ç¬¬ 7 å¤©æ‰å›žå¤ï¼š

```
å‰ 30 åˆ†é’Ÿ: 1800 ç§’ / 30 ç§’ = 60 æ¬¡
30-60 åˆ†é’Ÿ: 1800 ç§’ / 60 ç§’ = 30 æ¬¡
1 å°æ—¶ - 7 å¤©: (604800 - 3600) ç§’ / 120 ç§’ = 5010 æ¬¡

æ€»è®¡: çº¦ 5100 æ¬¡ API è°ƒç”¨
```

**Telegram API é™åˆ¶**: 
- æ¯ç§’ 30 æ¬¡è¯·æ±‚
- æˆ‘ä»¬çš„æœ€é«˜é¢‘çŽ‡: æ¯ 30 ç§’ 1 æ¬¡
- **å®Œå…¨åœ¨é™åˆ¶èŒƒå›´å†…** âœ…

### ç”µé‡æ¶ˆè€—

- æ¯æ¬¡è½®è¯¢: ~10ms CPU æ—¶é—´
- 7 å¤©æ€»è®¡: ~51 ç§’ CPU æ—¶é—´
- **å‡ ä¹Žå¯ä»¥å¿½ç•¥ä¸è®¡** âœ…

## ðŸŽ® å®žé™…ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¿«é€Ÿäº¤äº’ï¼ˆ5 åˆ†é’Ÿå†…ï¼‰

```
15:00:00 - å¯åŠ¨ä»»åŠ¡
15:00:30 - æ£€æŸ¥ï¼ˆæ— æ¶ˆæ¯ï¼‰
15:01:00 - æ£€æŸ¥ï¼ˆæ— æ¶ˆæ¯ï¼‰
15:01:30 - æ£€æŸ¥ï¼ˆæ— æ¶ˆæ¯ï¼‰
15:02:00 - æ£€æŸ¥ï¼ˆæ— æ¶ˆæ¯ï¼‰
15:02:30 - æ£€æŸ¥ï¼ˆæ— æ¶ˆæ¯ï¼‰
15:03:00 - æ£€æŸ¥ï¼ˆæ”¶åˆ°å›žå¤ï¼ï¼‰âœ…
```

**å“åº”æ—¶é—´**: æœ€å¤š 30 ç§’å»¶è¿Ÿ

### åœºæ™¯ 2: åˆé¤æ—¶é—´ï¼ˆ1 å°æ—¶ï¼‰

```
12:00 - å¯åŠ¨ä»»åŠ¡ï¼ŒåŽ»åƒåˆé¥­
12:30 - åˆ‡æ¢åˆ° 60 ç§’é—´éš”
13:00 - å›žæ¥ï¼Œå‘é€å›žå¤
13:01 - æ”¶åˆ°å›žå¤ï¼âœ…
```

**å“åº”æ—¶é—´**: æœ€å¤š 60 ç§’å»¶è¿Ÿ

### åœºæ™¯ 3: è¿‡å¤œä»»åŠ¡ï¼ˆ12 å°æ—¶ï¼‰

```
22:00 - å¯åŠ¨ä»»åŠ¡ï¼ŒåŽ»ç¡è§‰
22:30 - åˆ‡æ¢åˆ° 60 ç§’é—´éš”
23:00 - åˆ‡æ¢åˆ° 120 ç§’é—´éš”
...æ•´å¤œæŒç»­è½®è¯¢...
08:00 - èµ·åºŠï¼Œå‘é€å›žå¤
08:02 - æ”¶åˆ°å›žå¤ï¼âœ…
```

**å“åº”æ—¶é—´**: æœ€å¤š 120 ç§’å»¶è¿Ÿ

### åœºæ™¯ 4: å‘¨æœ«ä»»åŠ¡ï¼ˆ3 å¤©ï¼‰

```
å‘¨äº” 18:00 - å¯åŠ¨ä»»åŠ¡ï¼Œå¼€å§‹å‘¨æœ«
å‘¨äº” 19:00 - åˆ‡æ¢åˆ° 120 ç§’é—´éš”
...æ•´ä¸ªå‘¨æœ«æŒç»­è½®è¯¢...
å‘¨ä¸€ 09:00 - å›žåˆ°åŠžå…¬å®¤ï¼Œå‘é€å›žå¤
å‘¨ä¸€ 09:02 - æ”¶åˆ°å›žå¤ï¼âœ…
```

**å“åº”æ—¶é—´**: æœ€å¤š 120 ç§’å»¶è¿Ÿ

## ðŸ” ç›‘æŽ§è½®è¯¢çŠ¶æ€

### æŸ¥çœ‹æ—¥å¿—

```bash
tail -f /tmp/telegram-mcp-server.log | grep getUpdates
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
15:00:00 - HTTP Request: POST .../getUpdates "HTTP/1.1 200 OK"
15:00:30 - HTTP Request: POST .../getUpdates "HTTP/1.1 200 OK"
15:01:00 - HTTP Request: POST .../getUpdates "HTTP/1.1 200 OK"
...
```

### è®¡ç®—å½“å‰é—´éš”

æ ¹æ®æ—¥å¿—æ—¶é—´æˆ³çš„é—´éš”ï¼š
- 30 ç§’ â†’ å¿«é€Ÿå“åº”æœŸ
- 60 ç§’ â†’ ä¸­ç­‰å“åº”æœŸ
- 120 ç§’ â†’ èŠ‚èƒ½æ¨¡å¼

## âš™ï¸ Codex é…ç½®è¦æ±‚

ç”±äºŽ Codex æœ‰å·¥å…·è¶…æ—¶é™åˆ¶ï¼Œéœ€è¦é…ç½®ï¼š

```toml
[mcp_servers.telegram]
tool_timeout_sec = 604800  # 7 å¤©

[mcp_servers.telegram.env]
TELEGRAM_MAX_WAIT = "604800"  # åŒ¹é…è¶…æ—¶æ—¶é—´
```

**é‡è¦**: `tool_timeout_sec` å¿…é¡» >= `TELEGRAM_MAX_WAIT`

## ðŸ“ æœ€ä½³å®žè·µ

### 1. æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©è¶…æ—¶

| åœºæ™¯ | æŽ¨èé…ç½® |
|------|---------|
| å¿«é€Ÿå¼€å‘ | `tool_timeout_sec = 3600`ï¼ˆ1 å°æ—¶ï¼‰ |
| æ—¥å¸¸ä½¿ç”¨ | `tool_timeout_sec = 86400`ï¼ˆ24 å°æ—¶ï¼‰ |
| å®Œå…¨æ— äººå€¼å®ˆ | `tool_timeout_sec = 604800`ï¼ˆ7 å¤©ï¼‰ |

### 2. è‡ªå®šä¹‰è½®è¯¢é—´éš”

å¦‚æžœä½ å¸Œæœ›æ›´å¿«çš„å“åº”ï¼š

```bash
# æ›´æ¿€è¿›çš„è½®è¯¢ï¼ˆæ¶ˆè€—æ›´å¤šèµ„æºï¼‰
TELEGRAM_POLL_INTERVAL="10,20,30" codex
```

å¦‚æžœä½ å¸Œæœ›èŠ‚çœèµ„æºï¼š

```bash
# æ›´ä¿å®ˆçš„è½®è¯¢ï¼ˆå“åº”æ›´æ…¢ï¼‰
TELEGRAM_POLL_INTERVAL="60,120,300" codex
```

### 3. ç›‘æŽ§é•¿æ—¶é—´è¿è¡Œ

å¯¹äºŽè¶…è¿‡ 1 å¤©çš„ä»»åŠ¡ï¼š

```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ç›‘æŽ§
watch -n 60 'tail -1 /tmp/telegram-mcp-server.log'
```

## ðŸ†š ä¸Žå…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

### å›ºå®šé—´éš”è½®è¯¢

```
æ¯ 30 ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ŒæŒç»­ 7 å¤©
API è°ƒç”¨: 604800 / 30 = 20160 æ¬¡ âŒ å¤ªå¤š
```

### æŒ‡æ•°é€€é¿

```
30s â†’ 60s â†’ 120s â†’ 240s â†’ 480s â†’ ...
é—®é¢˜: åŽæœŸå“åº”å¤ªæ…¢ï¼ˆå¯èƒ½ 8 åˆ†é’Ÿæ‰æ£€æŸ¥ä¸€æ¬¡ï¼‰âŒ
```

### æ¸è¿›å¼è½®è¯¢ï¼ˆæˆ‘ä»¬çš„æ–¹æ¡ˆï¼‰

```
30s â†’ 60s â†’ 120sï¼ˆä¿æŒï¼‰
API è°ƒç”¨: ~5100 æ¬¡ âœ… åˆç†
å“åº”æ—¶é—´: æœ€å¤š 120 ç§’ âœ… å¯æŽ¥å—
```

## ðŸ’¡ æŠ€æœ¯å®žçŽ°

### ä»£ç ä½ç½®

`telegram_mcp_server/server.py`:

```python
def get_poll_interval(elapsed_seconds: float) -> int:
    """
    Get polling interval based on elapsed time
    Progressive slowdown: 30s â†’ 60s â†’ 120s
    """
    if elapsed_seconds < 1800:  # < 30 minutes
        return 30  # 30 seconds
    elif elapsed_seconds < 3600:  # < 1 hour
        return 60  # 60 seconds
    else:
        return 120  # 120 seconds
```

### é…ç½®ä½ç½®

`telegram_mcp_server/config.py`:

```python
TELEGRAM_MAX_WAIT = int(os.getenv("TELEGRAM_MAX_WAIT", "604800"))  # 7 days
POLL_INTERVALS = [30, 60, 120]  # seconds
POLL_THRESHOLDS = [1800, 3600]  # 30 minutes, 1 hour
```

## ðŸŽ¯ æ€»ç»“

- âœ… **æ™ºèƒ½**: æ ¹æ®ç­‰å¾…æ—¶é—´è‡ªåŠ¨è°ƒæ•´
- âœ… **é«˜æ•ˆ**: å¿«é€Ÿå“åº” + èŠ‚çœèµ„æº
- âœ… **çµæ´»**: å¯è‡ªå®šä¹‰æ‰€æœ‰å‚æ•°
- âœ… **å¯é **: æœ€é•¿å¯ç­‰å¾… 7 å¤©
- âœ… **å®žç”¨**: è¦†ç›–æ‰€æœ‰å®žé™…åœºæ™¯

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ¬ MCP æœåŠ¡å™¨éžå¸¸é€‚åˆçœŸæ­£çš„æ— äººå€¼å®ˆæ¨¡å¼ï¼** ðŸš€
